/*!
* p-camera-h5 v1.0.0-beta.1
* Copyright 2024 Pbstar (https://github.com/pbstar)
* Licensed under MIT (https://github.com/pbstar/p-camera-h5/blob/main/LICENSE)
* 2025-02-20 16:02:34
*/
function e(e,t,i,r){if("a"===i&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)}function t(e,t,i,r,a){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,i):a?a.value=i:t.set(e,i),i}"function"==typeof SuppressedError&&SuppressedError;var i,r,a,s,o,n,h="#p-camera-h5 {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: relative;\r\n  background-color: #000;\r\n}\r\n#p-camera-h5 video {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  object-fit: cover;\r\n}\r\n";!function(e,t){void 0===t&&(t={});var i=t.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===i&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}(h);class d{constructor(h){if(i.set(this,void 0),r.set(this,void 0),a.set(this,void 0),s.set(this,void 0),o.set(this,void 0),n.set(this,void 0),t(this,i,{el:document.body,watermark:{text:"",image:"",position:"bottom-right",color:"rgba(255, 255, 255, 0.5)",fontSize:"20px"}},"f"),!h.el)throw new Error("el is required");Object.assign(e(this,i,"f"),h),t(this,r,null,"f"),t(this,a,null,"f"),t(this,s,[],"f"),t(this,o,null,"f"),t(this,n,null,"f"),this.init()}async init(){this.setupUI(),await this.setupCamera(),this.setupWatermark()}setupUI(){e(this,i,"f").el.innerHTML='\n  <div id="p-camera-h5">\n    <video id="p-camera-h5-video" autoplay playsinline></video>\n    <div id="p-camera-h5-watermark" class="watermark"></div>\n  </div>\n';const t=document.createElement("style");t.innerHTML=JSON.stringify(h),e(this,i,"f").el.appendChild(t)}async setupCamera(){try{t(this,o,document.getElementById("p-camera-h5-video"),"f"),t(this,r,await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),"f"),e(this,o,"f").srcObject=e(this,r,"f")}catch(e){throw new Error("Error accessing media devices: "+e.message)}}setupWatermark(){if(!e(this,i,"f").watermark.text&&!e(this,i,"f").watermark.image)throw new Error("watermark text or image is required");if(t(this,n,document.getElementById("p-camera-h5-watermark"),"f"),!e(this,n,"f"))throw new Error("watermark is not initialized");Object.assign(e(this,n,"f").style,{position:"absolute",pointerEvents:"none",color:e(this,i,"f").watermark.color,fontSize:e(this,i,"f").watermark.fontSize});if(e(this,i,"f").watermark.position.split("-").forEach((t=>{e(this,n,"f")&&(e(this,n,"f").style[t]="10px")})),e(this,i,"f").watermark.text)e(this,n,"f").textContent=e(this,i,"f").watermark.text;else if(e(this,i,"f").watermark.image){const t=new Image;t.src=e(this,i,"f").watermark.image,e(this,n,"f").appendChild(t)}}capture(){if(!e(this,o,"f"))throw new Error("video is not initialized");const t=document.createElement("canvas");t.width=e(this,o,"f").videoWidth,t.height=e(this,o,"f").videoHeight;return t.getContext("2d").drawImage(e(this,o,"f"),0,0),t.toDataURL("image/png")}startRecording(){t(this,s,[],"f");if(!e(this,r,"f"))throw new Error("mediaStream is not initialized");t(this,a,new MediaRecorder(e(this,r,"f"),{mimeType:"video/webm"}),"f"),e(this,a,"f").ondataavailable=t=>{t.data.size>0&&e(this,s,"f").push(t.data)},e(this,a,"f").start()}stopRecording(){return new Promise((t=>{if(!e(this,a,"f"))throw new Error("mediaRecorder is not initialized");e(this,a,"f").onstop=()=>{const i=new Blob(e(this,s,"f"),{type:"video/webm"});t(URL.createObjectURL(i))},e(this,a,"f").stop()}))}destroy(){if(!e(this,o,"f"))throw new Error("video is not initialized");if(!e(this,r,"f"))throw new Error("mediaStream is not initialized");e(this,r,"f").getTracks().forEach((e=>e.stop())),e(this,i,"f").el.removeChild(e(this,o,"f")),e(this,n,"f")&&e(this,i,"f").el.removeChild(e(this,n,"f"))}}i=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap,o=new WeakMap,n=new WeakMap;export{d as default};
